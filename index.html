<!DOCTYPE html>
<html>

<head>
    <title>CryonPlace</title>
    <script src="js\api\coinGeckoAPI.js"></script>
    <script src="js\favorites.js"></script>
    <script src="js\searchBar.js"></script>
    <script>

        window.onload = async () => {
            loadFavoriteCoinsFromLocalStorage();
            allCoins = await getAllCoins();
            let coins = await getCoins();
            dadosTabela(coins);
            Pesquisa(allCoins);
        }

        function Pesquisa(allCoins) {
            let lista = document.getElementById("lista");
            let listaHtml = "";

            document.getElementById("barraPesquisa").addEventListener("keyup", async (e) => {

                let dataListOptions = document.getElementById("lista");
                dataListOptions.innerHTML = "";

                let filteredCoins = await getSearchResults(e);

                let counter = 0;
                for (let index = 0; index < filteredCoins.length; index++) {

                        setTimeout(() => {
                            let optionData = document.createElement("option");
                            optionData.value = filteredCoins[index].id;
                            optionData.innerHTML = filteredCoins[index].name;
                            dataListOptions.append(optionData);
                        }, 20);
                        counter = 0;
                    
                    counter++;
                }
            });
        }

        function dadosTabela(coins) {
            let tabela = document.getElementById("Dados");
            let tabelaHtml = "";

            for (let coin of coins) {

                tabelaHtml += `<tr><td>${coin.market_data.market_cap_rank}</td><td>${coin.name}</td> 
                        <td>${coin.market_data.current_price.usd}</td><td>${coin.market_data.price_change_24h}
                            </td><td><button onClick="Favoritos('${coin.id}')">fav</button></td></tr>`;

            }
            tabela.innerHTML = tabelaHtml;
        }

        function Favoritos(coinId) {
            if (favoriteCoins.includes(coinId)) {
                removeFromFavorites(coinId);
            }
            else {
                addToFavorites(coinId);
            }
        }

    </script>
</head>

<body>
    <div>
        <input id="barraPesquisa" list="lista" placeholder="Pesquisar">
        <datalist id="lista">
        </datalist>
    </div>
    <div>
        <table>
            <thead>
                <tr style="font-size: 20px;">
                    <th>Ranking</th>
                    <th>Moeda</th>
                    <th>Pre√ßo</th>
                    <th>24 Horas</th>
                </tr>
            </thead>
            <tbody id="Dados"></tbody>
        </table>
    </div>

</body>

</html>